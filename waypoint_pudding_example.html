
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- The scroll library -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/noframework.waypoints.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js'></script>
  <!-- <script src='./js/scroll-snap-4.0.3.js'></script> -->
  <script src="./js/jquery.easeScroll.js"></script>


  <style>
    .graphic {
      width: 100%;
      position: relative;
    }

    .graphic__prose {
      width: 60%;
      /*margin-top: calc( 50vh - 150px );*/
      height: fit-content;
    }

    .graphic__prose .trigger {
      height: fit-content;
      padding: 50px;
      margin: 100px 50px 100vh 50px;
      background: gray;
      color: white !important;
      vertical-align: middle;
      box-shadow: 0 0 1px 0 black;
    }

    .graphic__vis {
      position: fixed; /* note: originally absolute */
      top: 0;
      right: 0;
      height: 100%;
      width: 40%;
    }

    .graphic__vis .img_wrapper {
      height: 300px;
      width: 100%;
      margin: calc( 50vh - 150px ) auto;
      background: none;
      background-size: cover !important;
      transition: all 1s;
    }

    .graphic__vis.is-fixed {
      position: fixed;
    }

    .graphic__vis.is-bottom {
      top: auto;
      bottom: 0;
    }

  </style>
</head>
<body>

  <div class='graphic'>
    <div class='graphic__prose'>
      <p class='trigger' data-step='0'>Step 1 in the graphic. It triggers in the middle of the viewport. For this graphic, it is the same as the initial state so the reader doesn&rsquo;t miss anything.</p>

      <p class='trigger' data-step='1'>Step 2 arrives. The graphic should be locking into a fixed position right about now. We could have a whole bunch of these &ldquo;fixed&rdquo; steps.</p>

      <p class='trigger' data-step='1'>Step 2 arrives. The graphic should be locking into a fixed position right about now. We could have a whole bunch of these &ldquo;fixed&rdquo; steps.</p>

      <p class='trigger' data-step='1'>Step 2 arrives. The graphic should be locking into a fixed position right about now. We could have a whole bunch of these &ldquo;fixed&rdquo; steps.</p>

      <p class='trigger' data-step='2'>Step 2 arrives. The graphic should be locking into a fixed position right about now. We could have a whole bunch of these &ldquo;fixed&rdquo; steps.</p>

      <p class='trigger' data-step='2'>Step 2 arrives. The graphic should be locking into a fixed position right about now. We could have a whole bunch of these &ldquo;fixed&rdquo; steps.</p>

      <p class='trigger' data-step='2'>Step 2 arrives. The graphic should be locking into a fixed position right about now. We could have a whole bunch of these &ldquo;fixed&rdquo; steps.</p>

      <p class='trigger' data-step='3'>Step 3 concludes our brief tour. The graphic should now go back to its original in-flow position, elegantly snapping back into place.</p>
    </div>
    <div class='graphic__vis'>
      <!-- <img src='./assets/img/portfolio/superglue.jpg'/> -->
      <div class='img_wrapper'></div>
    </div>
  </div>

  <script type="text/javascript">




    /* 
  I've created a function here that is a simple d3 chart.
  This could be anthing that has discrete steps, as simple as changing
  the background color, or playing/pausing a video.
  The important part is that it exposes and update function that
  calls a new thing on a scroll trigger.
  */
  window.createGraphic = function(graphicSelector) {

    var graphicEl = d3.select('.graphic')
    var graphicVisEl = graphicEl.select('.graphic__vis')
    var graphicProseEl = graphicEl.select('.graphic__prose')
    var graphicVisImg = graphicVisEl.select('img')
    var graphicVisImgWrapper = graphicVisEl.select('.img_wrapper')

  // actions to take on each step of our scroll-driven story
  var steps = [
  function step0() {
    graphicVisImgWrapper.style('background', 'url(./assets/img/portfolio/dbms.jpg)');
  },

  function step1() {
    graphicVisImgWrapper.style('background', 'url(./assets/img/portfolio/superglue.jpg)');
    // graphicVisImg.attr('src', './assets/img/portfolio/presenceid.jpg');
  },

  function step2() {
    graphicVisImgWrapper.style('background', 'url(./assets/img/portfolio/presenceid.jpg)');
    // graphicVisImg.attr('src', './assets/img/portfolio/dbms.jpg');
  },

  function step3() {
    graphicVisImgWrapper.style('background', 'url(./assets/img/portfolio/irclogparser.jpg)');
    // graphicVisImg.attr('src', './assets/img/portfolio/irclogparser.jpg');
  },
  ]

  // update our chart
  function update(step) {
    steps[step].call()
  }

  update(0);

  return {
    update: update,
  }
}

$(document).ready(function() {

      // helper function so we can map over dom selection
      function selectionToArray(selection) {
        var len = selection.length;
        var result = [];
        for (var i = 0; i < len; i++) {
          result.push(selection[i]);
        }
        return result;
      }

      function waypoints() {
        // select elements
        var graphicEl = document.querySelector('.graphic');
        var graphicVisEl = graphicEl.querySelector('.graphic__vis');
        var triggerEls = selectionToArray(graphicEl.querySelectorAll('.trigger'));

        // viewport height
        var viewportHeight = window.innerHeight;
        var halfViewportHeight = Math.floor(viewportHeight / 2);

        // a global function creates and handles all the vis + updates
        var graphic = createGraphic('.graphic');

        // handle the fixed/static position of grahpic
        var toggle = function(fixed, bottom) {
          if (fixed) 
            graphicVisEl.classList.add('is-fixed');
          else 
            graphicVisEl.classList.remove('is-fixed');

          if (bottom) 
            graphicVisEl.classList.add('is-bottom');
          else 
            graphicVisEl.classList.remove('is-bottom');
        }

        // setup a waypoint trigger for each trigger element
        var waypoints = triggerEls.map(function(el) {

          // get the step, cast as number         
          var step = +el.getAttribute('data-step');

          return new Waypoint({
            element: el, // our trigger element
            handler: function(direction) {
              // if the direction is down then we use that number,
              // else, we want to trigger the previous one
              var nextStep = direction === 'down' ? step : Math.max(0, step - 1);
              
              // tell our graphic to update with a specific step
              graphic.update(nextStep);
            },
            offset: '50%',  // trigger halfway up the viewport
          });
        });

        // enter (top) / exit (bottom) graphic (toggle fixed position)
        var enterWaypoint = new Waypoint({
          element: graphicEl,
          handler: function(direction) {
            var fixed = direction === 'down';
            var bottom = false;
            toggle(fixed, bottom);
          },
        });

        var exitWaypoint = new Waypoint({
          element: graphicEl,
          handler: function(direction) {
            var fixed = direction === 'up';
            var bottom = !fixed;
            toggle(fixed, bottom);
          },
          offset: 'bottom-in-view', // waypoints convenience instead of a calculation
        });
      }

      waypoints();

    });

$('html, body').easeScroll({
    frameRate: 30,
    // animationTime: 3000,
    stepSize: 30,
    // pulseAlgorithm: 1,
    // pulseScale: 8,
    // pulseNormalize: 1,
    // accelerationDelta: 20,
    // accelerationMax: 1,
    // keyboardSupport: true,
    // arrowScroll: 50,
    // touchpadSupport: true,
  });

// import createScrollSnap from 'scroll-snap';
// const element = document.getElementById('graphic');
// const { bind, unbind } = createScrollSnap(element, {
//   snapDestinationX: '0%',
//   snapDestinationY: '90%',
//   timeout: 100,
//   duration: 300,
//   threshold: 0.2,
//   snapStop: false,
//   easing: easeInOutQuad,
// }, () => console.log('element snapped'));

</script>

</body>
</html>
